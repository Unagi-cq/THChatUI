(self["webpackChunkTHChatUI"]=self["webpackChunkTHChatUI"]||[]).push([[82],{11082:function(e,t,o){"use strict";o.r(t),o.d(t,{fetchAPI:function(){return i}});var n=o(55965),s=o(32984),a=o(46387);const r={llm:"/yidong/remote/inference-api/exp-api/inf-1337014908971847680/v1/chat/completions",vim:"",igm:""};async function i({prompt:e,history:t,files:o,controller:i,onopen:l,onmessage:m,onclose:p,onerror:h}){const{setting:c}=a.A.state,{model_config:d}=c,{version:u,pre_method:_,type:g}=d,v=c.api_key_map[c.platform],f=r[g]||r.llm,y={method:"POST",headers:{Authorization:`Bearer ${v}`,"Content-Type":"application/json",Accept:"text/event-stream"},body:JSON.stringify((0,s.preProcess)(u,e,t,_,o,!1)),signal:i.signal,onopen:l,onmessage:m,onclose:p,onerror:h,openWhenHidden:!0};return await(0,n.y)(f,y)}},32984:function(e,t,o){function n(e,t,o,n,l,m){let p={};switch(console.log(m),n){case"text_ali":p={model:e,input:{messages:s(t,o)},parameters:{result_format:"message",incremental_output:!0}},m&&(p.parameters.enable_search=!0);break;case"text_baidu":p={model:e,messages:s(t,o),stream:!0},m&&(p.web_search={enable:!0});break;case"text_xunfei":p={parameter:{chat:{domain:"general",temperature:.5,max_tokens:1024}},payload:{message:{text:s(t,o)}}};break;case"text_moonshot_zhipu":p={model:e,messages:s(t,o),stream:!0};break;case"local":p={input:{prompt:t,history:i(o),files:l}};break;case"img_ali":p={model:e,input:{messages:r(t,o,l)},parameters:{result_format:"message",incremental_output:!0}};break;case"img_zhipu":p={model:e,messages:a(t,o,l),stream:!0};break;case"igm_zhipu":p={model:e,prompt:t};break}return p}function s(e,t){function o(e){const t=[];for(let o=0;o<e.length-1;o++){const n=e[o];t.push({role:"user",content:n.query}),t.push({role:"assistant",content:n.answer})}return t}let n=o(t);return n.push({role:"user",content:e}),n}function a(e,t,o){function n(e){const t=[];for(let o=0;o<e.length-1;o++){const n=e[o];t.push({role:"user",content:[{type:"text",text:n.query}]}),t.push({role:"assistant",content:[{type:"text",text:n.answer}]})}return t}let s=n(t),a=[];return o&&o.length>0&&o[0].base64&&a.push({type:"image_url",image_url:{url:o[0].base64}}),a.push({type:"text",text:e}),s.push({role:"user",content:a}),s}function r(e,t,o){function n(e){const t=[];for(let o=0;o<e.length-1;o++){const n=e[o];t.push({role:"user",content:[{text:n.query}]}),t.push({role:"assistant",content:[{text:n.answer}]})}return t}let s=n(t),a=[];return o&&o.length>0&&o[0].base64&&a.push({image:o[0].base64}),a.push({text:e}),s.push({role:"user",content:a}),s}function i(e){const t=[];for(let o=0;o<e.length;o++){const n=e[o];t.push({user:n.query,assistant:n.answer})}return t}function l(e,t){switch(t){case"base":return{content:JSON.parse(e.data).output.choices[0].message.content};case"text":const o=JSON.parse(e.data).output.choices[0].message.content;return{content:o&&o.length>0?o[0].text:""};case"add":return{content:e};case"delta":return{content:JSON.parse(e.data).choices[0].delta.content};case"delta_reasoning":return JSON.parse(e.data).choices[0].delta.reasoning_content?{reasoning_content:JSON.parse(e.data).choices[0].delta.reasoning_content}:{content:JSON.parse(e.data).choices[0].delta.content};case"baidu":return{content:JSON.parse(e.data).result};case"llm_local":if("data"!==e.event)return"";const n=JSON.parse(e.data);try{return{content:n.data.content}}catch(e){console.error(e)}case"igm_zhipu":return{content:e.data[0].url};default:return console.warn(`未知的后处理方法: ${t}`),e}}o(44114),e.exports={model_list:{Ali_DashScope:{platform_name:"阿里云百炼",list:[{type:"llm",name:"qwen-turbo",series:"qwen",version:"qwen-turbo-latest",pre_method:"text_ali",post_method:"base",can_web_search:!0},{type:"llm",name:"qwen-plus",series:"qwen",version:"qwen-plus-latest",pre_method:"text_ali",post_method:"base",can_web_search:!0},{type:"llm",name:"qwen-max",series:"qwen",version:"qwen-max-latest",pre_method:"text_ali",post_method:"base",can_web_search:!0},{type:"llm",name:"qwen-math-turbo",series:"qwen",version:"qwen-math-turbo-latest",pre_method:"text_ali",post_method:"base"},{type:"llm",name:"qwen-coder-plus",series:"qwen",version:"qwen-coder-plus-latest",pre_method:"text_ali",post_method:"base"},{type:"vim",name:"qwen-vl-max",series:"qwen",version:"qwen-vl-max-latest",pre_method:"img_ali",post_method:"text"},{type:"vim",name:"qwen-vl-plus",series:"qwen",version:"qwen-vl-plus-latest",pre_method:"img_ali",post_method:"text"},{type:"vim",name:"qwen-vl-ocr",series:"qwen",version:"qwen-vl-ocr-latest",pre_method:"img_ali",post_method:"text"}]},Baidu_QianFan:{platform_name:"百度千帆",list:[{type:"llm",name:"ernie-4.0-8k",series:"wenxin",version:"ernie-4.0-8k-latest",pre_method:"text_baidu",post_method:"baidu",can_web_search:!0},{type:"llm",name:"ernie-speed-128k",series:"wenxin",version:"ernie-speed-128k",pre_method:"text_baidu",post_method:"baidu"},{type:"llm",name:"ernie-tiny-8k",series:"wenxin",version:"ernie-tiny-8k",pre_method:"text_baidu",post_method:"baidu"},{type:"llm",name:"ernie-lite-8k",series:"wenxin",version:"ernie-lite-8k",pre_method:"text_baidu",post_method:"baidu"},{type:"llm",name:"Yi-34B-Chat",series:"yi",version:"yi_34b_chat",pre_method:"text_baidu",post_method:"baidu"}]},Moonshot_AI:{platform_name:"月之暗面",list:[{type:"llm",name:"moonshot-v1-8k",series:"moonshot",version:"moonshot-v1-8k",pre_method:"text_moonshot_zhipu",post_method:"delta"},{type:"llm",name:"moonshot-v1-32k",series:"moonshot",version:"moonshot-v1-32k",pre_method:"text_moonshot_zhipu",post_method:"delta"},{type:"llm",name:"moonshot-v1-128k",series:"moonshot",version:"moonshot-v1-128k",pre_method:"text_moonshot_zhipu",post_method:"delta"}]},Xunfei_Spark:{platform_name:"讯飞星火",list:[{type:"llm",name:"Spark Lite 🆓",series:"xunfei",version:"spark lite",pre_method:"text_xunfei",post_method:"add"}]},Zhipu_BigModel:{platform_name:"智谱AI",list:[{type:"llm",name:"glm-4-flash 🆓",series:"zhipu",version:"glm-4-flash",pre_method:"text_moonshot_zhipu",post_method:"delta"},{type:"llm",name:"glm-4-0520",series:"zhipu",version:"glm-4-0520",pre_method:"text_moonshot_zhipu",post_method:"delta"},{type:"llm",name:"glm-4-air",series:"zhipu",version:"glm-4-air",pre_method:"text_moonshot_zhipu",post_method:"delta"},{type:"llm",name:"glm-4-plus",series:"zhipu",version:"glm-4-plus",pre_method:"text_moonshot_zhipu",post_method:"delta"},{type:"llm",name:"glm-4-long",series:"zhipu",version:"glm-4-long",pre_method:"text_moonshot_zhipu",post_method:"delta"},{type:"llm",name:"glm-4-flashx",series:"zhipu",version:"glm-4-flashx",pre_method:"text_moonshot_zhipu",post_method:"delta"},{type:"llm",name:"glm-4-airx",series:"zhipu",version:"glm-4-airx",pre_method:"text_moonshot_zhipu",post_method:"delta"},{type:"llm",name:"glm-4",series:"zhipu",version:"glm-4",pre_method:"text_moonshot_zhipu",post_method:"delta"},{type:"vim",name:"glm-4v",series:"zhipu",version:"glm-4v",pre_method:"img_zhipu",post_method:"delta"},{type:"igm",name:"cogview-3-flash 🆓",series:"zhipu",version:"cogview-3-flash",pre_method:"igm_zhipu",post_method:"igm_zhipu"},{type:"igm",name:"cogview-3",series:"zhipu",version:"cogview-3",pre_method:"igm_zhipu",post_method:"igm_zhipu"},{type:"igm",name:"cogview-3-plus",series:"zhipu",version:"cogview-3-plus",pre_method:"igm_zhipu",post_method:"igm_zhipu"}]},TT_Volcengine:{platform_name:"火山方舟",list:[{type:"llm",name:"deepseek-r1",series:"volcengine",version:"",pre_method:"text_moonshot_zhipu",post_method:"delta_reasoning"}]},Yidong_CMECloud:{platform_name:"移动云",list:[{type:"llm",name:"default",series:"default",version:"default",pre_method:"text_moonshot_zhipu",post_method:"delta"}]},OpenAI:{platform_name:"OpenAI",list:[{type:"llm",name:"llm",series:"default",version:"llm_default",pre_method:"text_moonshot_zhipu",post_method:"add"}]},Local:{platform_name:"本地调用",list:[{type:"llm",name:"对话模型",series:"local",version:"llm_local",pre_method:"local",post_method:"llm_local",can_web_search:!0},{type:"vim",name:"图片理解模型",series:"local",version:"vim_local",pre_method:"local",post_method:"llm_local"},{type:"igm",name:"图片生成模型",series:"local",version:"igm_local",pre_method:"local",post_method:"igm_zhipu"}]}},preProcess:n,postProcess:l}},55965:function(e,t,o){"use strict";async function n(e,t){const o=e.getReader();let n;while(!(n=await o.read()).done)t(n.value)}function s(e){let t,o,n,s=!1;return function(a){void 0===t?(t=a,o=0,n=-1):t=r(t,a);const i=t.length;let l=0;while(o<i){s&&(10===t[o]&&(l=++o),s=!1);let a=-1;for(;o<i&&-1===a;++o)switch(t[o]){case 58:-1===n&&(n=o-l);break;case 13:s=!0;case 10:a=o;break}if(-1===a)break;e(t.subarray(l,a),n),l=o,n=-1}l===i?t=void 0:0!==l&&(t=t.subarray(l),o-=l)}}function a(e,t,o){let n=i();const s=new TextDecoder;return function(a,r){if(0===a.length)null===o||void 0===o||o(n),n=i();else if(r>0){const o=s.decode(a.subarray(0,r)),i=r+(32===a[r+1]?2:1),l=s.decode(a.subarray(i));switch(o){case"data":n.data=n.data?n.data+"\n"+l:l;break;case"event":n.event=l;break;case"id":e(n.id=l);break;case"retry":const o=parseInt(l,10);isNaN(o)||t(n.retry=o);break}}}}function r(e,t){const o=new Uint8Array(e.length+t.length);return o.set(e),o.set(t,e.length),o}function i(){return{data:"",event:"",id:"",retry:void 0}}o.d(t,{y:function(){return c}});var l=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var s=0;for(n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(o[n[s]]=e[n[s]])}return o};const m="text/event-stream",p=1e3,h="last-event-id";function c(e,t){var{signal:o,headers:r,onopen:i,onmessage:c,onclose:u,onerror:_,openWhenHidden:g,fetch:v}=t,f=l(t,["signal","headers","onopen","onmessage","onclose","onerror","openWhenHidden","fetch"]);return new Promise(((t,l)=>{const y=Object.assign({},r);let b;function w(){b.abort(),document.hidden||S()}y.accept||(y.accept=m),g||document.addEventListener("visibilitychange",w);let x=p,k=0;function z(){document.removeEventListener("visibilitychange",w),window.clearTimeout(k),b.abort()}null===o||void 0===o||o.addEventListener("abort",(()=>{z(),t()}));const q=null!==v&&void 0!==v?v:window.fetch,O=null!==i&&void 0!==i?i:d;async function S(){var o;b=new AbortController;try{const o=await q(e,Object.assign(Object.assign({},f),{headers:y,signal:b.signal}));await O(o),await n(o.body,s(a((e=>{e?y[h]=e:delete y[h]}),(e=>{x=e}),c))),null===u||void 0===u||u(),z(),t()}catch(r){if(!b.signal.aborted)try{const e=null!==(o=null===_||void 0===_?void 0:_(r))&&void 0!==o?o:x;window.clearTimeout(k),k=window.setTimeout(S,e)}catch(i){z(),l(i)}}}S()}))}function d(e){const t=e.headers.get("content-type");if(!(null===t||void 0===t?void 0:t.startsWith(m)))throw new Error(`Expected content-type to be ${m}, Actual: ${t}`)}}}]);
//# sourceMappingURL=82.6584beb5.js.map