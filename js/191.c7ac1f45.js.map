{"version":3,"file":"js/191.c7ac1f45.js","mappings":"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","sources":["webpack://THChatUI/./src/util/config.js","webpack://THChatUI/./src/api/OpenAI/index.js"],"sourcesContent":["/**\n * @fileoverview èŠå¤©åº”ç”¨çš„é…ç½®æ–‡ä»¶\n * åŒ…å«æ¨¡å‹é…ç½®ã€æ¶ˆæ¯é¢„å¤„ç†å’Œåå¤„ç†çš„ç›¸å…³åŠŸèƒ½\n * æ”¯æŒå¤šä¸ªAIå¹³å°çš„æ¥å…¥ï¼ŒåŒ…æ‹¬é˜¿é‡Œäº‘ã€ç™¾åº¦ã€è®¯é£ã€æ™ºè°±AIç­‰\n */\n\n/**\n * å‰å¤„ç†(å…¥å‚)è§„åˆ™å¤„ç†\n * @param {string} model_version - æ¨¡å‹ç‰ˆæœ¬æ ‡è¯†\n * @param {string} prompt - ç”¨æˆ·å½“å‰çš„è¾“å…¥å†…å®¹\n * @param {Array} history - å†å²å¯¹è¯è®°å½•æ•°ç»„\n * @param {string} pre_method - é¢„å¤„ç†æ–¹æ³•æ ‡è¯†\n * @param {Array} files - ä¸Šä¼ çš„æ–‡ä»¶æ•°ç»„ï¼Œä¸»è¦ç”¨äºå›¾åƒå¤„ç†\n * @param {boolean} is_search - æ˜¯å¦å¯ç”¨ç½‘ç»œæœç´¢åŠŸèƒ½\n */\nfunction preProcess(model_version, prompt, history, pre_method, files, is_search) {\n    let body = {};\n    switch (pre_method) {\n        // é˜¿é‡Œå¹³å°çš„æ–‡æœ¬è¾“å…¥æ ¼å¼\n        case \"text_ali\":\n            body = {\n                model: model_version,\n                input: {\n                    messages: buildLlmMessage(prompt, history)\n                },\n                parameters: {\n                    result_format: \"message\",\n                    incremental_output: true\n                }\n            }\n            if (is_search) {\n                body.parameters.enable_search = true;\n            }\n            break;\n        // ç™¾åº¦å¹³å°çš„æ–‡æœ¬è¾“å…¥æ ¼å¼\n        case \"text_baidu\":\n            body = {\n                model: model_version,\n                messages: buildLlmMessage(prompt, history),\n                stream: true\n            }\n            if (is_search) {\n                body.web_search = {\n                    enable: true\n                };\n            }\n            break;\n        // è®¯é£å¹³å°çš„æ–‡æœ¬è¾“å…¥æ ¼å¼\n        case \"text_xunfei\":\n            body = {\n                parameter: {\n                    chat: {\n                        domain: \"general\",\n                        temperature: 0.5,\n                        max_tokens: 1024,\n                    },\n                },\n                payload: {\n                    message: {\n                        text: buildLlmMessage(prompt, history)\n                    },\n                },\n            }\n            break;\n        // æ™ºè°±AIå’Œæœˆä¹‹æš—é¢çš„æ–‡æœ¬è¾“å…¥æ ¼å¼\n        case \"text_moonshot_zhipu\":\n            body = {\n                model: model_version,\n                messages: buildLlmMessage(prompt, history),\n                stream: true\n            }\n            break;\n        // æœ¬åœ°æ¥å£ æ–‡æœ¬è¾“å…¥æ ¼å¼\n        case \"local\": \n            body = {\n                input: {\n                    prompt: prompt,\n                    history: getLocalHistory(history),\n                    files: files\n                }\n            };\n            break;\n        // é˜¿é‡Œå¹³å°çš„å›¾ç‰‡è¾“å…¥æ ¼å¼\n        case \"img_ali\":\n            body = {\n                model: model_version,\n                input: {\n                    messages: buildAliVLMessage(prompt, history, files)\n                },\n                parameters: {\n                    result_format: \"message\",\n                    incremental_output: true\n                }\n            }\n            break;\n        // æ™ºè°±AIå¹³å°çš„å›¾ç‰‡è¾“å…¥æ ¼å¼\n        case \"img_zhipu\":\n            body = {\n                model: model_version,\n                messages: buildZhipuVLMessage(prompt, history, files),\n                stream: true\n            }\n            break;\n        // æ™ºè°±AIå¹³å°çš„å›¾ç‰‡ç”Ÿæˆæ¨¡å‹è¾“å…¥æ ¼å¼\n        case \"igm_zhipu\":\n            body = {\n                model: model_version,\n                prompt: prompt\n            }\n            break;\n    }\n    return body;\n}\n\n/**\n * æ„å»ºLLMæ–‡æœ¬å¯¹è¯æ¶ˆæ¯\n * @param {string} prompt - ç”¨æˆ·å½“å‰çš„è¾“å…¥å†…å®¹\n * @param {Array} history - å†å²å¯¹è¯è®°å½•æ•°ç»„\n */\nfunction buildLlmMessage(prompt, history) {\n    function getHistory(history) {\n        const array = [];\n        // æ’é™¤æœ€åä¸€æ¡ historyï¼Œå› ä¸ºæ˜¯æœ¬æ¬¡åˆšå‘çš„æ¶ˆæ¯\n        for (let i = 0; i < history.length - 1; i++) {\n            const chat = history[i];\n            array.push({\n                \"role\": \"user\",\n                \"content\": chat.query\n            });\n            array.push({\n                \"role\": \"assistant\",\n                \"content\": chat.answer\n            });\n        }\n        return array;\n    }\n    let arr = getHistory(history)\n    arr.push({\n        \"role\": \"user\",\n        \"content\": prompt\n    })\n    return arr;\n}\n\n/**\n * æ„å»ºæ™ºè°±AIå¹³å°çš„å¤šæ¨¡æ€æ¶ˆæ¯\n * @param {string} prompt - ç”¨æˆ·å½“å‰çš„è¾“å…¥å†…å®¹\n * @param {Array} history - å†å²å¯¹è¯è®°å½•æ•°ç»„\n * @param {Array} files - ä¸Šä¼ çš„æ–‡ä»¶æ•°ç»„ï¼Œä¸»è¦åŒ…å«å›¾ç‰‡çš„base64æ•°æ®\n */\nfunction buildZhipuVLMessage(prompt, history, files) {\n    function getHistory(history) {\n        const array = [];\n        // æ’é™¤æœ€åä¸€æ¡ historyï¼Œå› ä¸ºæ˜¯æœ¬æ¬¡åˆšå‘çš„æ¶ˆæ¯\n        for (let i = 0; i < history.length - 1; i++) {\n            const chat = history[i];\n            array.push({\n                \"role\": \"user\",\n                \"content\": [{ \"type\": \"text\", \"text\": chat.query }]\n            });\n            array.push({\n                \"role\": \"assistant\",\n                \"content\": [{ \"type\": \"text\", \"text\": chat.answer }]\n            });\n        }\n        return array;\n    }\n    let arr = getHistory(history);\n    let content = [];\n\n    if (files && files.length > 0 && files[0].base64) {\n        content.push({\n            \"type\": \"image_url\",\n            \"image_url\": {\n                \"url\": files[0].base64\n            }\n        });\n    }\n\n    content.push({\n        \"type\": \"text\",\n        \"text\": prompt\n    });\n\n    arr.push({\n        \"role\": \"user\",\n        \"content\": content\n    });\n\n    return arr;\n}\n\n/**\n * æ„å»ºé˜¿é‡Œäº‘å¹³å°çš„å¤šæ¨¡æ€æ¶ˆæ¯\n * @param {string} prompt - ç”¨æˆ·å½“å‰çš„è¾“å…¥å†…å®¹\n * @param {Array} history - å†å²å¯¹è¯è®°å½•æ•°ç»„\n * @param {Array} files - ä¸Šä¼ çš„æ–‡ä»¶æ•°ç»„ï¼Œä¸»è¦åŒ…å«å›¾ç‰‡çš„base64æ•°æ®\n */\nfunction buildAliVLMessage(prompt, history, files) {\n    function getHistory(history) {\n        const array = [];\n        // æ’é™¤æœ€åä¸€æ¡ historyï¼Œå› ä¸ºæ˜¯æœ¬æ¬¡åˆšå‘çš„æ¶ˆæ¯\n        for (let i = 0; i < history.length - 1; i++) {\n            const chat = history[i];\n            array.push({\n                \"role\": \"user\",\n                \"content\": [{ \"text\": chat.query }]\n            });\n            array.push({\n                \"role\": \"assistant\",\n                \"content\": [{ \"text\": chat.answer }]\n            });\n        }\n        return array;\n    }\n    let arr = getHistory(history);\n    let content = [];\n\n    if (files && files.length > 0 && files[0].base64) {\n        content.push({\n            \"image\": files[0].base64\n        });\n    }\n\n    content.push({\n        \"text\": prompt\n    });\n\n    arr.push({\n        \"role\": \"user\",\n        \"content\": content\n    });\n\n    return arr;\n}\n\n/**\n * æœ¬åœ°æ¥å£ æ‹¼æ¥å†å²å¯¹è¯\n * @param history\n * @returns {*[]}\n */\nfunction getLocalHistory(history) {\n    const array = [];\n    for (let i = 0; i < history.length; i++) {\n        const chat = history[i];\n        array.push({\n            user: chat.query,\n            assistant: chat.answer,\n        });\n    }\n\n    return array;\n}\n\n/**\n * åå¤„ç†(å‡ºå‚)è§„åˆ™å¤„ç†\n * @param {Object} e - APIè¿”å›çš„åŸå§‹æ•°æ®\n * @param {string} post_method - åå¤„ç†æ–¹æ³•æ ‡è¯†\n */\nfunction postProcess(e, post_method) {\n    switch (post_method) {\n        case \"base\":\n            return {content:JSON.parse(e.data).output.choices[0].message.content};\n        case \"text\":\n            const content = JSON.parse(e.data).output.choices[0].message.content;\n            return { content: content && content.length > 0 ? content[0].text : '' };\n        case \"add\":\n            return {content:e};\n        case \"delta\":\n            return {content:JSON.parse(e.data).choices[0].delta.content};\n        case \"delta_reasoning\":\n            if (JSON.parse(e.data).choices[0].delta.reasoning_content) {\n                return {reasoning_content:JSON.parse(e.data).choices[0].delta.reasoning_content};\n            } else {\n                return {content:JSON.parse(e.data).choices[0].delta.content};\n            }\n        case \"baidu\":\n            return {content:JSON.parse(e.data).result};\n        case \"llm_local\":\n            if (e.event !== 'data') return '';\n            // è§£æchunké‡Œé¢çš„dataå‚æ•°\n            const data = JSON.parse(e.data);\n            try {\n                return {content:data.data.content};\n            } catch (e) {\n                console.error(e)\n            }\n        case \"igm_zhipu\":\n            return {content:e.data[0].url};\n        default:\n            console.warn(`æœªçŸ¥çš„åå¤„ç†æ–¹æ³•: ${post_method}`);\n            return e;\n    }\n}\n\nmodule.exports = {\n    /**\n     * æ¨¡å‹åˆ—è¡¨\n     */\n    model_list: {\n        \"Ali_DashScope\": {\n            platform_name: \"é˜¿é‡Œäº‘ç™¾ç‚¼\",\n            list: [\n                { type: \"llm\", name: \"qwen-turbo\", series: \"qwen\", version: \"qwen-turbo-latest\", pre_method: \"text_ali\", post_method: \"base\", can_web_search: true },\n                { type: \"llm\", name: \"qwen-plus\", series: \"qwen\", version: \"qwen-plus-latest\", pre_method: \"text_ali\", post_method: \"base\", can_web_search: true },\n                { type: \"llm\", name: \"qwen-max\", series: \"qwen\", version: \"qwen-max-latest\", pre_method: \"text_ali\", post_method: \"base\", can_web_search: true },\n                { type: \"llm\", name: \"qwen-math-turbo\", series: \"qwen\", version: \"qwen-math-turbo-latest\", pre_method: \"text_ali\", post_method: \"base\" },\n                { type: \"llm\", name: \"qwen-coder-plus\", series: \"qwen\", version: \"qwen-coder-plus-latest\", pre_method: \"text_ali\", post_method: \"base\" },\n                { type: \"vim\", name: \"qwen-vl-max\", series: \"qwen\", version: \"qwen-vl-max-latest\", pre_method: \"img_ali\", post_method: \"text\" },\n                { type: \"vim\", name: \"qwen-vl-plus\", series: \"qwen\", version: \"qwen-vl-plus-latest\", pre_method: \"img_ali\", post_method: \"text\" },\n                { type: \"vim\", name: \"qwen-vl-ocr\", series: \"qwen\", version: \"qwen-vl-ocr-latest\", pre_method: \"img_ali\", post_method: \"text\" },\n            ]\n        },\n        \"Baidu_QianFan\":\n        {\n            platform_name: \"ç™¾åº¦åƒå¸†\",\n            list: [\n                { type: \"llm\", name: \"ernie-4.0-8k\", series: \"wenxin\", version: \"ernie-4.0-8k-latest\", pre_method: \"text_baidu\", post_method: \"baidu\", can_web_search: true },\n                { type: \"llm\", name: \"ernie-speed-128k\", series: \"wenxin\", version: \"ernie-speed-128k\", pre_method: \"text_baidu\", post_method: \"baidu\" },\n                { type: \"llm\", name: \"ernie-tiny-8k\", series: \"wenxin\", version: \"ernie-tiny-8k\", pre_method: \"text_baidu\", post_method: \"baidu\" },\n                { type: \"llm\", name: \"ernie-lite-8k\", series: \"wenxin\", version: \"ernie-lite-8k\", pre_method: \"text_baidu\", post_method: \"baidu\" },\n                { type: \"llm\", name: \"Yi-34B-Chat\", series: \"yi\", version: \"yi_34b_chat\", pre_method: \"text_baidu\", post_method: \"baidu\" }\n            ]\n        },\n        \"Moonshot_AI\":\n        {\n            platform_name: \"æœˆä¹‹æš—é¢\",\n            list: [\n                { type: \"llm\", name: \"moonshot-v1-8k\", series: \"moonshot\", version: \"moonshot-v1-8k\", pre_method: \"text_moonshot_zhipu\", post_method: \"delta\" },\n                { type: \"llm\", name: \"moonshot-v1-32k\", series: \"moonshot\", version: \"moonshot-v1-32k\", pre_method: \"text_moonshot_zhipu\", post_method: \"delta\" },\n                { type: \"llm\", name: \"moonshot-v1-128k\", series: \"moonshot\", version: \"moonshot-v1-128k\", pre_method: \"text_moonshot_zhipu\", post_method: \"delta\" }\n            ]\n        },\n        \"Xunfei_Spark\":\n        {\n            platform_name: \"è®¯é£æ˜Ÿç«\",\n            list: [\n                { type: \"llm\", name: \"Spark Lite ğŸ†“\", series: \"xunfei\", version: \"spark lite\", pre_method: \"text_xunfei\", post_method: \"add\" }\n            ]\n        },\n        \"Zhipu_BigModel\":\n        {\n            platform_name: \"æ™ºè°±AI\",\n            list: [\n                { type: \"llm\", name: \"glm-4-flash ğŸ†“\", series: \"zhipu\", version: \"glm-4-flash\", pre_method: \"text_moonshot_zhipu\", post_method: \"delta\" },\n                { type: \"llm\", name: \"glm-4-0520\", series: \"zhipu\", version: \"glm-4-0520\", pre_method: \"text_moonshot_zhipu\", post_method: \"delta\" },\n                { type: \"llm\", name: \"glm-4-air\", series: \"zhipu\", version: \"glm-4-air\", pre_method: \"text_moonshot_zhipu\", post_method: \"delta\" },\n                { type: \"llm\", name: \"glm-4-plus\", series: \"zhipu\", version: \"glm-4-plus\", pre_method: \"text_moonshot_zhipu\", post_method: \"delta\" },\n                { type: \"llm\", name: \"glm-4-long\", series: \"zhipu\", version: \"glm-4-long\", pre_method: \"text_moonshot_zhipu\", post_method: \"delta\" },\n                { type: \"llm\", name: \"glm-4-flashx\", series: \"zhipu\", version: \"glm-4-flashx\", pre_method: \"text_moonshot_zhipu\", post_method: \"delta\" },\n                { type: \"llm\", name: \"glm-4-airx\", series: \"zhipu\", version: \"glm-4-airx\", pre_method: \"text_moonshot_zhipu\", post_method: \"delta\" },\n                { type: \"llm\", name: \"glm-4\", series: \"zhipu\", version: \"glm-4\", pre_method: \"text_moonshot_zhipu\", post_method: \"delta\" },\n                { type: \"vim\", name: \"glm-4v\", series: \"zhipu\", version: \"glm-4v\", pre_method: \"img_zhipu\", post_method: \"delta\" },\n                { type: \"igm\", name: \"cogview-3-flash ğŸ†“\", series: \"zhipu\", version: \"cogview-3-flash\", pre_method: \"igm_zhipu\", post_method: \"igm_zhipu\" },\n                { type: \"igm\", name: \"cogview-3\", series: \"zhipu\", version: \"cogview-3\", pre_method: \"igm_zhipu\", post_method: \"igm_zhipu\" },\n                { type: \"igm\", name: \"cogview-3-plus\", series: \"zhipu\", version: \"cogview-3-plus\", pre_method: \"igm_zhipu\", post_method: \"igm_zhipu\" },\n            ]\n        },\n        \"TT_Volcengine\":\n        {\n            platform_name: \"ç«å±±æ–¹èˆŸ\",\n            list: [\n                { type: \"llm\", name: \"deepseek-r1\", series: \"volcengine\", version: \"\", pre_method: \"text_moonshot_zhipu\", post_method: \"delta_reasoning\" }\n            ]\n        },\n        \"Yidong_CMECloud\":\n        {\n            platform_name: \"ç§»åŠ¨äº‘\",\n            list: [\n                { type: \"llm\", name: \"default\", series: \"default\", version: \"default\", pre_method: \"text_moonshot_zhipu\", post_method: \"delta\" }\n            ]\n        },\n        \"OpenAI\":\n        {\n            platform_name: \"OpenAI\",\n            list: [\n                { type: \"llm\", name: \"llm\", series: \"default\", version: \"llm_default\", pre_method: \"text_moonshot_zhipu\", post_method: \"add\" }\n            ]\n        },\n        \"Local\":\n        {\n            platform_name: \"æœ¬åœ°è°ƒç”¨\",\n            list: [\n                { type: \"llm\", name: \"å¯¹è¯æ¨¡å‹\", series: \"local\", version: \"llm_local\", pre_method: \"local\", post_method: \"llm_local\", can_web_search: true },\n                { type: \"vim\", name: \"å›¾ç‰‡ç†è§£æ¨¡å‹\", series: \"local\", version: \"vim_local\", pre_method: \"local\", post_method: \"llm_local\" },\n                { type: \"igm\", name: \"å›¾ç‰‡ç”Ÿæˆæ¨¡å‹\", series: \"local\", version: \"igm_local\", pre_method: \"local\", post_method: \"igm_zhipu\" },\n            ]\n        }\n    },\n    /**\n     * å‰å¤„ç†(å…¥å‚)è§„åˆ™å¤„ç†\n     */\n    preProcess: preProcess,\n    /**\n     * åå¤„ç†(å‡ºå‚)è§„åˆ™å¤„ç†\n     */\n    postProcess: postProcess\n}","/**\n * @fileoverview OpenAIå¹³å°çš„HTTPè°ƒç”¨ã€‚\n * æ¥å£é‡‡ç”¨SSEè¯·æ±‚æ–¹å¼ï¼Œä¸éœ€è¦è·¨åŸŸé…ç½®\n */\nconst OpenAI = require('openai')\nimport {preProcess} from \"@/util/config\"\nimport store from '../../store';\n\n/**\n * è°ƒç”¨OpenAIå¹³å°çš„æ¥å£\n * @param {string} prompt - ç”¨æˆ·è¾“å…¥çš„é—®é¢˜\n * @param {Array} history - å†å²å¯¹è¯æ¶ˆæ¯\n * @param {Array} files - æ–‡ä»¶åˆ—è¡¨\n * @param {AbortController} controller - æ§åˆ¶è¯·æ±‚çš„å–æ¶ˆ\n * @param {Function} onopen - è¿æ¥æˆåŠŸå›è°ƒ\n * @param {Function} onmessage - æ¥æ”¶æ¶ˆæ¯å›è°ƒ\n * @param {Function} onclose - è¿æ¥å…³é—­å›è°ƒ\n * @param {Function} onerror - é”™è¯¯å¤„ç†å›è°ƒ\n */\nexport async function fetchAPI({\n    prompt,\n    history,\n    files,\n    controller,\n    onopen,\n    onmessage,\n    onclose,\n    onerror\n}) {\n    const { setting } = store.state;\n    const { model_config } = setting;\n    const { pre_method } = model_config;\n    const { endpoint, api_key, model_name } = setting.api_key_map['OpenAI'];\n\n    const openai = new OpenAI({\n        apiKey: api_key,\n        baseURL: endpoint,\n        temperature: 0,\n        dangerouslyAllowBrowser: true\n    });\n\n    try {\n        const stream = await openai.chat.completions.create({\n            ...preProcess(model_name, prompt, history, pre_method, files, false),\n            stream: true,\n        });\n\n        onopen?.();\n\n        for await (const chunk of stream) {\n            const content = chunk.choices[0]?.delta?.content || '';\n            onmessage?.(content);\n        }\n\n        onclose?.();\n    } catch (error) {\n        onerror?.(error);\n        throw error;\n    }\n}\n"],"names":["preProcess","model_version","prompt","history","pre_method","files","is_search","body","model","input","messages","buildLlmMessage","parameters","result_format","incremental_output","enable_search","stream","web_search","enable","parameter","chat","domain","temperature","max_tokens","payload","message","text","getLocalHistory","buildAliVLMessage","buildZhipuVLMessage","getHistory","array","i","length","push","query","answer","arr","content","base64","user","assistant","postProcess","e","post_method","JSON","parse","data","output","choices","delta","reasoning_content","result","event","console","error","url","warn","module","exports","model_list","platform_name","list","type","name","series","version","can_web_search","OpenAI","require","async","fetchAPI","controller","onopen","onmessage","onclose","onerror","setting","store","state","model_config","endpoint","api_key","model_name","api_key_map","openai","apiKey","baseURL","dangerouslyAllowBrowser","completions","create","chunk"],"sourceRoot":""}