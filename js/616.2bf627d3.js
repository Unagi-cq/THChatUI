"use strict";(self["webpackChunkTHChatUI"]=self["webpackChunkTHChatUI"]||[]).push([[616],{21616:function(t,n,e){e.r(n),e.d(n,{fetchAPI:function(){return r},postProcess:function(){return i}});e(44114);var o=e(46387);const s=e(51701);async function r({prompt:t,history:n,files:e,controller:r,onopen:a,onmessage:i,onclose:u,onerror:l}){const{setting:f}=o.A.state,{model_config:h}=f,{type:p,endpoint:w,api_key:g,version:m}=h,d=new s({apiKey:g,baseURL:w,temperature:0,dangerouslyAllowBrowser:!0});try{const o=await d.chat.completions.create({...c(m,t,n,p,e,!1),stream:!0});a?.();for await(const t of o){const n=t||{};i?.(n)}u?.()}catch(y){throw l?.(y),y}}function c(t,n,e,o,s,r){let c={};switch(o){case"llm":c={model:t,messages:a(n,e)};break}return c}function a(t,n){function e(t){const n=[];for(let e=0;e<t.length-1;e++){const o=t[e];n.push({role:"user",content:o.query}),n.push({role:"assistant",content:o.answer})}return n}let o=e(n);return o.push({role:"user",content:t}),o}function i(t){if("[DONE]"===t)return{content:""};const n=t.choices[0];return"stop"===n.finish_reason?{content:""}:n.delta.reasoning_content?{reasoning_content:n.delta.reasoning_content}:{content:n.delta.content}}}}]);
//# sourceMappingURL=616.2bf627d3.js.map