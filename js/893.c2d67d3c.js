"use strict";(self["webpackChunkTHChatUI"]=self["webpackChunkTHChatUI"]||[]).push([[893],{5965:function(e,n,t){t.d(n,{y:function(){return h}});t(6573),t(8100),t(7936),t(7467),t(4732),t(9577);async function o(e,n){const t=e.getReader();let o;while(!(o=await t.read()).done)n(o.value)}function r(e){let n,t,o,r=!1;return function(a){void 0===n?(n=a,t=0,o=-1):n=i(n,a);const c=n.length;let s=0;while(t<c){r&&(10===n[t]&&(s=++t),r=!1);let a=-1;for(;t<c&&-1===a;++t)switch(n[t]){case 58:-1===o&&(o=t-s);break;case 13:r=!0;case 10:a=t;break}if(-1===a)break;e(n.subarray(s,a),o),s=t,o=-1}s===c?n=void 0:0!==s&&(n=n.subarray(s),t-=s)}}function a(e,n,t){let o=c();const r=new TextDecoder;return function(a,i){if(0===a.length)null===t||void 0===t||t(o),o=c();else if(i>0){const t=r.decode(a.subarray(0,i)),c=i+(32===a[i+1]?2:1),s=r.decode(a.subarray(c));switch(t){case"data":o.data=o.data?o.data+"\n"+s:s;break;case"event":o.event=s;break;case"id":e(o.id=s);break;case"retry":const t=parseInt(s,10);isNaN(t)||n(o.retry=t);break}}}}function i(e,n){const t=new Uint8Array(e.length+n.length);return t.set(e),t.set(n,e.length),t}function c(){return{data:"",event:"",id:"",retry:void 0}}var s=function(e,n){var t={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&n.indexOf(o)<0&&(t[o]=e[o]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(e);r<o.length;r++)n.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(e,o[r])&&(t[o[r]]=e[o[r]])}return t};const l="text/event-stream",d=1e3,u="last-event-id";function h(e,n){var{signal:t,headers:i,onopen:c,onmessage:h,onclose:p,onerror:b,openWhenHidden:v,fetch:y}=n,w=s(n,["signal","headers","onopen","onmessage","onclose","onerror","openWhenHidden","fetch"]);return new Promise(((n,s)=>{const g=Object.assign({},i);let m;function k(){m.abort(),document.hidden||x()}g.accept||(g.accept=l),v||document.addEventListener("visibilitychange",k);let O=d,_=0;function j(){document.removeEventListener("visibilitychange",k),window.clearTimeout(_),m.abort()}null===t||void 0===t||t.addEventListener("abort",(()=>{j(),n()}));const T=null!==y&&void 0!==y?y:window.fetch,P=null!==c&&void 0!==c?c:f;async function x(){var t;m=new AbortController;try{const t=await T(e,Object.assign(Object.assign({},w),{headers:g,signal:m.signal}));await P(t),await o(t.body,r(a((e=>{e?g[u]=e:delete g[u]}),(e=>{O=e}),h))),null===p||void 0===p||p(),j(),n()}catch(i){if(!m.signal.aborted)try{const e=null!==(t=null===b||void 0===b?void 0:b(i))&&void 0!==t?t:O;window.clearTimeout(_),_=window.setTimeout(x,e)}catch(c){j(),s(c)}}}x()}))}function f(e){const n=e.headers.get("content-type");if(!(null===n||void 0===n?void 0:n.startsWith(l)))throw new Error(`Expected content-type to be ${l}, Actual: ${n}`)}},5893:function(e,n,t){t.r(n),t.d(n,{fetchAPI:function(){return c}});var o=t(5965),r=t(2984),a=t(6387);const i={llm:"/baidu/remote/rpc/2.0/ai_custom/v1/wenxinworkshop/chat/",vim:"",igm:""};async function c({prompt:e,history:n,files:t,controller:c,onopen:s,onmessage:l,onclose:d,onerror:u}){const{setting:h}=a.A.state,{model_config:f,chat_type:p}=h,{version:b,pre_method:v,type:y,can_web_search:w}=f,g=h.api_key_map[h.platform],m=(i[y]||i.llm)+b+"?access_token="+g,k=void 0!==w&&w&&"web"===p,O={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify((0,r.preProcess)(b,e,n,v,t,k)),signal:c.signal,onopen:s,onmessage:l,onclose:d,onerror:u,openWhenHidden:!0};return await(0,o.y)(m,O)}}}]);
//# sourceMappingURL=893.c2d67d3c.js.map