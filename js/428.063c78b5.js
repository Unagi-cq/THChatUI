"use strict";(self["webpackChunkTHChatUI"]=self["webpackChunkTHChatUI"]||[]).push([[428],{5965:function(e,t,n){n.d(t,{y:function(){return h}});n(6573),n(8100),n(7936),n(7467),n(4732),n(9577);async function o(e,t){const n=e.getReader();let o;while(!(o=await n.read()).done)t(o.value)}function r(e){let t,n,o,r=!1;return function(a){void 0===t?(t=a,n=0,o=-1):t=i(t,a);const c=t.length;let s=0;while(n<c){r&&(10===t[n]&&(s=++n),r=!1);let a=-1;for(;n<c&&-1===a;++n)switch(t[n]){case 58:-1===o&&(o=n-s);break;case 13:r=!0;case 10:a=n;break}if(-1===a)break;e(t.subarray(s,a),o),s=n,o=-1}s===c?t=void 0:0!==s&&(t=t.subarray(s),n-=s)}}function a(e,t,n){let o=c();const r=new TextDecoder;return function(a,i){if(0===a.length)null===n||void 0===n||n(o),o=c();else if(i>0){const n=r.decode(a.subarray(0,i)),c=i+(32===a[i+1]?2:1),s=r.decode(a.subarray(c));switch(n){case"data":o.data=o.data?o.data+"\n"+s:s;break;case"event":o.event=s;break;case"id":e(o.id=s);break;case"retry":const n=parseInt(s,10);isNaN(n)||t(o.retry=n);break}}}}function i(e,t){const n=new Uint8Array(e.length+t.length);return n.set(e),n.set(t,e.length),n}function c(){return{data:"",event:"",id:"",retry:void 0}}var s=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(e);r<o.length;r++)t.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(e,o[r])&&(n[o[r]]=e[o[r]])}return n};const l="text/event-stream",d=1e3,u="last-event-id";function h(e,t){var{signal:n,headers:i,onopen:c,onmessage:h,onclose:f,onerror:v,openWhenHidden:b,fetch:g}=t,y=s(t,["signal","headers","onopen","onmessage","onclose","onerror","openWhenHidden","fetch"]);return new Promise(((t,s)=>{const m=Object.assign({},i);let w;function O(){w.abort(),document.hidden||E()}m.accept||(m.accept=l),b||document.addEventListener("visibilitychange",O);let k=d,j=0;function T(){document.removeEventListener("visibilitychange",O),window.clearTimeout(j),w.abort()}null===n||void 0===n||n.addEventListener("abort",(()=>{T(),t()}));const x=null!==g&&void 0!==g?g:window.fetch,A=null!==c&&void 0!==c?c:p;async function E(){var n;w=new AbortController;try{const n=await x(e,Object.assign(Object.assign({},y),{headers:m,signal:w.signal}));await A(n),await o(n.body,r(a((e=>{e?m[u]=e:delete m[u]}),(e=>{k=e}),h))),null===f||void 0===f||f(),T(),t()}catch(i){if(!w.signal.aborted)try{const e=null!==(n=null===v||void 0===v?void 0:v(i))&&void 0!==n?n:k;window.clearTimeout(j),j=window.setTimeout(E,e)}catch(c){T(),s(c)}}}E()}))}function p(e){const t=e.headers.get("content-type");if(!(null===t||void 0===t?void 0:t.startsWith(l)))throw new Error(`Expected content-type to be ${l}, Actual: ${t}`)}},1428:function(e,t,n){n.r(t),n.d(t,{fetchAPI:function(){return c}});var o=n(5965),r=n(2984),a=n(6387);const i={llm:"/ali/remote/api/v1/services/aigc/text-generation/generation",vim:"/ali/remote/api/v1/services/aigc/multimodal-generation/generation",igm:""};async function c({prompt:e,history:t,files:n,controller:c,onopen:s,onmessage:l,onclose:d,onerror:u}){const{setting:h}=a.A.state,{model_config:p,chat_type:f}=h,{version:v,pre_method:b,type:g,can_web_search:y}=p,m=h.api_key_map[h.platform],w=i[g]||i.llm,O=void 0!==y&&y&&"web"===f,k={method:"POST",headers:{Authorization:`Bearer ${m}`,"Content-Type":"application/json",Accept:"text/event-stream","X-DashScope-SSE":"enable"},body:JSON.stringify((0,r.preProcess)(v,e,t,b,n,O)),signal:c.signal,onopen:s,onmessage:l,onclose:d,onerror:u,openWhenHidden:!0};return await(0,o.y)(w,k)}}}]);
//# sourceMappingURL=428.063c78b5.js.map