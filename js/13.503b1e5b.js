"use strict";(self["webpackChunkTHChatUI"]=self["webpackChunkTHChatUI"]||[]).push([[13],{42013:function(e,t,s){s.r(t),s.d(t,{default:function(){return te}});var i=s(56768),l=s(24232);const o={class:"mcp-container"},n={class:"mcp-sidebar"},r={class:"add-server"},a={class:"server-list"},c=["onClick"],d={class:"mcp-content"},u={key:0,class:"empty-state"},p={key:1,class:"server-config"},m={class:"config-header"},h={class:"header-actions"},g={class:"config-form"},v={class:"form-item"},k={class:"form-item"},C={class:"radio-group"},f={class:"form-item"},y={key:0,class:"tools-section"},S={class:"tools-header"},T={class:"tools-actions"},L={key:0,class:"connection-status"},b={key:1,class:"tools-list"},_={class:"tools-count"},E={class:"tool-card"},X={class:"tool-header"},V={class:"tool-name"},F={class:"tool-description"},w={key:0,class:"tool-parameters"},P={class:"parameters-list"},U={class:"param-name"},$={class:"param-type"},A={key:0,class:"param-required"},Q={key:1,class:"param-description"},W={class:"tool-actions"},R={key:2,class:"tools-empty"},q={key:1,class:"config-actions"},x={key:0,class:"test-dialog-content"},D={class:"test-tool-info"},M={key:0,class:"test-parameters"},I={class:"test-form"},O={class:"test-label"},j={key:0,class:"required"},K={key:0,class:"test-param-desc"},B={key:1,class:"test-result"},N={class:"result-content"},z={class:""};function H(e,t,s,H,J,G){const Y=(0,i.g2)("el-button"),Z=(0,i.g2)("el-switch"),ee=(0,i.g2)("el-input"),te=(0,i.g2)("el-radio"),se=(0,i.g2)("el-alert"),ie=(0,i.g2)("el-tag"),le=(0,i.g2)("el-col"),oe=(0,i.g2)("el-row"),ne=(0,i.g2)("el-empty"),re=(0,i.g2)("el-dialog");return(0,i.uX)(),(0,i.CE)("div",o,[(0,i.Lk)("div",n,[(0,i.Lk)("div",r,[(0,i.bF)(Y,{type:"primary",onClick:G.handleAddServer},{default:(0,i.k6)((()=>t[6]||(t[6]=[(0,i.eW)("添加服务器")]))),_:1},8,["onClick"])]),(0,i.Lk)("div",a,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(J.mcpServers,((e,t)=>((0,i.uX)(),(0,i.CE)("div",{key:t,class:(0,l.C4)(["server-item",{active:J.currentServer===t}]),onClick:e=>G.selectServer(t)},(0,l.v_)(e.name),11,c)))),128))])]),(0,i.Lk)("div",d,[J.currentServer||J.isAddingServer?((0,i.uX)(),(0,i.CE)("div",p,[(0,i.Lk)("div",m,[(0,i.Lk)("h2",null,(0,l.v_)(J.isAddingServer?"添加服务器":"编辑服务器"),1),(0,i.Lk)("div",h,[(0,i.bF)(Z,{modelValue:J.currentConfig.enabled,"onUpdate:modelValue":t[0]||(t[0]=e=>J.currentConfig.enabled=e)},null,8,["modelValue"]),(0,i.bF)(Y,{type:"primary",onClick:G.saveConfig},{default:(0,i.k6)((()=>t[7]||(t[7]=[(0,i.eW)("保存")]))),_:1},8,["onClick"])])]),(0,i.Lk)("div",g,[(0,i.Lk)("div",v,[t[8]||(t[8]=(0,i.Lk)("div",{class:"form-label required"},"名称",-1)),(0,i.bF)(ee,{modelValue:J.currentConfig.name,"onUpdate:modelValue":t[1]||(t[1]=e=>J.currentConfig.name=e),placeholder:"请输入名称"},null,8,["modelValue"])]),(0,i.Lk)("div",k,[t[11]||(t[11]=(0,i.Lk)("div",{class:"form-label required"},"类型",-1)),(0,i.Lk)("div",C,[(0,i.bF)(te,{modelValue:J.currentConfig.type,"onUpdate:modelValue":t[2]||(t[2]=e=>J.currentConfig.type=e),label:"stdio",disabled:""},{default:(0,i.k6)((()=>t[9]||(t[9]=[(0,i.eW)("标准输入/输出(stdio)")]))),_:1},8,["modelValue"]),(0,i.bF)(te,{modelValue:J.currentConfig.type,"onUpdate:modelValue":t[3]||(t[3]=e=>J.currentConfig.type=e),label:"sse"},{default:(0,i.k6)((()=>t[10]||(t[10]=[(0,i.eW)("服务器发送事件(sse)")]))),_:1},8,["modelValue"])])]),(0,i.Lk)("div",f,[t[12]||(t[12]=(0,i.Lk)("div",{class:"form-label required"},"URL",-1)),(0,i.bF)(ee,{modelValue:J.currentConfig.url,"onUpdate:modelValue":t[4]||(t[4]=e=>J.currentConfig.url=e),placeholder:"请输入URL"},null,8,["modelValue"])])]),!J.isAddingServer&&J.currentConfig.enabled?((0,i.uX)(),(0,i.CE)("div",y,[(0,i.Lk)("div",S,[t[13]||(t[13]=(0,i.Lk)("h3",null,"工具管理",-1)),(0,i.Lk)("div",T,[(0,i.bF)(Y,{type:"primary",loading:J.isLoadingTools,onClick:G.loadTools,disabled:!J.currentConfig.url},{default:(0,i.k6)((()=>[(0,i.eW)((0,l.v_)(J.isLoadingTools?"查询中...":"查询工具"),1)])),_:1},8,["loading","onClick","disabled"])])]),J.connectionStatus?((0,i.uX)(),(0,i.CE)("div",L,[(0,i.bF)(se,{title:J.connectionStatus.message,type:J.connectionStatus.type,closable:!1,"show-icon":""},null,8,["title","type"])])):(0,i.Q3)("",!0),J.tools.length>0?((0,i.uX)(),(0,i.CE)("div",b,[(0,i.Lk)("div",_,[(0,i.Lk)("span",null,"共找到 "+(0,l.v_)(J.tools.length)+" 个工具",1)]),(0,i.bF)(oe,{gutter:16,class:"tools-grid"},{default:(0,i.k6)((()=>[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(J.tools,((e,s)=>((0,i.uX)(),(0,i.Wv)(le,{xs:24,sm:24,md:12,lg:8,xl:8,key:s},{default:(0,i.k6)((()=>[(0,i.Lk)("div",E,[(0,i.Lk)("div",X,[(0,i.Lk)("h4",V,(0,l.v_)(e.name),1),(0,i.bF)(ie,{size:"small",type:"info"},{default:(0,i.k6)((()=>[(0,i.eW)((0,l.v_)(e.inputSchema?.type||"object"),1)])),_:2},1024)]),(0,i.Lk)("div",F,(0,l.v_)(e.description||"暂无描述"),1),e.inputSchema?.properties?((0,i.uX)(),(0,i.CE)("div",w,[t[14]||(t[14]=(0,i.Lk)("div",{class:"parameters-title"},"参数:",-1)),(0,i.Lk)("div",P,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(e.inputSchema.properties,((t,s)=>((0,i.uX)(),(0,i.CE)("div",{key:s,class:"parameter-item"},[(0,i.Lk)("span",U,(0,l.v_)(s),1),(0,i.Lk)("span",$,(0,l.v_)(t.type),1),e.inputSchema.required?.includes(s)?((0,i.uX)(),(0,i.CE)("span",A,"*")):(0,i.Q3)("",!0),t.description?((0,i.uX)(),(0,i.CE)("div",Q,(0,l.v_)(t.description),1)):(0,i.Q3)("",!0)])))),128))])])):(0,i.Q3)("",!0),(0,i.Lk)("div",W,[(0,i.bF)(Y,{size:"small",type:"primary",onClick:t=>G.testTool(e)},{default:(0,i.k6)((()=>t[15]||(t[15]=[(0,i.eW)("测试工具")]))),_:2},1032,["onClick"])])])])),_:2},1024)))),128))])),_:1})])):!J.isLoadingTools&&J.hasTriedLoading?((0,i.uX)(),(0,i.CE)("div",R,[(0,i.bF)(ne,{description:"暂无可用工具"})])):(0,i.Q3)("",!0)])):(0,i.Q3)("",!0),J.isAddingServer?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.CE)("div",q,[(0,i.bF)(Y,{type:"danger",onClick:G.deleteServer},{default:(0,i.k6)((()=>t[16]||(t[16]=[(0,i.eW)("删除")]))),_:1},8,["onClick"])]))])):((0,i.uX)(),(0,i.CE)("div",u," 请选择或添加一个MCP服务器 "))]),(0,i.bF)(re,{modelValue:J.showTestDialog,"onUpdate:modelValue":t[5]||(t[5]=e=>J.showTestDialog=e),title:"测试工具",width:"600px"},{footer:(0,i.k6)((()=>[(0,i.Lk)("div",z,[(0,i.bF)(Y,{onClick:G.closeTestDialog},{default:(0,i.k6)((()=>t[18]||(t[18]=[(0,i.eW)("取消")]))),_:1},8,["onClick"]),(0,i.bF)(Y,{type:"primary",loading:J.isTestingTool,onClick:G.executeTest},{default:(0,i.k6)((()=>[(0,i.eW)((0,l.v_)(J.isTestingTool?"执行中...":"执行测试"),1)])),_:1},8,["loading","onClick"])])])),default:(0,i.k6)((()=>[J.testingTool?((0,i.uX)(),(0,i.CE)("div",x,[(0,i.Lk)("div",D,[(0,i.Lk)("h4",null,(0,l.v_)(J.testingTool.name),1),(0,i.Lk)("p",null,(0,l.v_)(J.testingTool.description),1)]),J.testingTool.inputSchema?.properties?((0,i.uX)(),(0,i.CE)("div",M,[(0,i.Lk)("div",I,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(J.testingTool.inputSchema.properties,((e,t)=>((0,i.uX)(),(0,i.CE)("div",{key:t,class:"test-form-item"},[(0,i.Lk)("label",O,[(0,i.eW)((0,l.v_)(t)+" ",1),J.testingTool.inputSchema.required?.includes(t)?((0,i.uX)(),(0,i.CE)("span",j,"*")):(0,i.Q3)("",!0)]),(0,i.bF)(ee,{modelValue:J.testParameters[t],"onUpdate:modelValue":e=>J.testParameters[t]=e,placeholder:e.description||`请输入${t}`,type:"number"===e.type?"number":"text"},null,8,["modelValue","onUpdate:modelValue","placeholder","type"]),e.description?((0,i.uX)(),(0,i.CE)("div",K,(0,l.v_)(e.description),1)):(0,i.Q3)("",!0)])))),128))])])):(0,i.Q3)("",!0),J.testResult?((0,i.uX)(),(0,i.CE)("div",B,[t[17]||(t[17]=(0,i.Lk)("h5",null,"执行结果:",-1)),(0,i.Lk)("pre",N,(0,l.v_)(JSON.stringify(J.testResult,null,2)),1)])):(0,i.Q3)("",!0)])):(0,i.Q3)("",!0)])),_:1},8,["modelValue"])])}s(18111),s(7588);var J=s(51219),G=s(12933),Y={name:"McpView",data(){return{mcpServers:{},currentServer:"",isAddingServer:!1,currentConfig:{name:"",type:"sse",url:"",enabled:!0},connectionStatus:null,tools:[],isLoadingTools:!1,hasTriedLoading:!1,showTestDialog:!1,testingTool:null,testParameters:{},testResult:null,isTestingTool:!1,mcpClient:null}},mounted(){const e=this.$store.state.setting;e.mcpServers&&(this.mcpServers=e.mcpServers)},beforeUnmount(){if(this.mcpClient&&"function"===typeof this.mcpClient.disconnect)try{this.mcpClient.disconnect()}catch(e){console.error("断开MCP客户端连接失败:",e)}},methods:{selectServer(e){if(this.mcpClient&&"function"===typeof this.mcpClient.disconnect)try{this.mcpClient.disconnect()}catch(t){console.error("断开之前的MCP连接失败:",t)}this.currentServer=e,this.isAddingServer=!1,Object.assign(this.currentConfig,this.mcpServers[e]),this.tools=[],this.connectionStatus=null,this.hasTriedLoading=!1,this.mcpClient=null},handleAddServer(){this.isAddingServer=!0,this.currentServer="",Object.assign(this.currentConfig,{name:"",type:"sse",url:"",enabled:!0}),this.tools=[],this.connectionStatus=null,this.hasTriedLoading=!1,this.mcpClient=null},saveConfig(){if(!this.currentConfig.name)return void J.nk.error("请输入服务器名称");if(!this.currentConfig.url)return void J.nk.error("请输入URL");const e={...this.mcpServers};if(this.isAddingServer){const t=`server_${Date.now()}`;e[t]={...this.currentConfig},this.currentServer=t}else e[this.currentServer]={...this.currentConfig};this.mcpServers=e,this.$store.dispatch("changeSetting",{key:"mcpServers",value:e}),this.isAddingServer=!1,J.nk.success("保存成功")},deleteServer(){G.s.confirm("确定要删除此服务器吗？此操作不可恢复。","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e={...this.mcpServers};delete e[this.currentServer],this.mcpServers=e,this.$store.dispatch("changeSetting",{key:"mcpServers",value:e}),this.currentServer="",J.nk.success("删除成功")})).catch((()=>{}))},async createMCPClient(){try{return this.mcpClient}catch(e){throw console.error("创建MCP客户端失败:",e),e}},async loadTools(){this.isLoadingTools=!0,this.hasTriedLoading=!0,this.connectionStatus=null;try{const e=await this.createMCPClient();await e.connect({sseUrl:this.currentConfig.url});const t=await e.getTools();this.tools=t||[],this.connectionStatus={message:`连接成功，找到 ${this.tools.length} 个工具`,type:"success"},J.nk.success(`工具加载成功，共 ${this.tools.length} 个工具`)}catch(e){console.error("加载工具失败:",e),this.tools=[];let t="连接失败";e.message&&(t+=`: ${e.message}`),e.code&&(t+=` (错误代码: ${e.code})`),this.connectionStatus={message:t,type:"error"},J.nk.error(t)}finally{this.isLoadingTools=!1}},testTool(e){this.testingTool=e,this.showTestDialog=!0,this.testParameters={},this.testResult=null,e.inputSchema?.properties&&Object.keys(e.inputSchema.properties).forEach((e=>{this.testParameters[e]=""}))},async executeTest(){if(this.mcpClient){if(this.testingTool.inputSchema?.required)for(const e of this.testingTool.inputSchema.required)if(!this.testParameters[e])return void J.nk.error(`请填写必需参数: ${e}`);this.isTestingTool=!0;try{const e={};Object.keys(this.testParameters).forEach((t=>{const s=this.testParameters[t],i=this.testingTool.inputSchema?.properties?.[t];""!==s&&null!==s&&void 0!==s&&("number"===i?.type?e[t]=Number(s):"boolean"===i?.type?e[t]=Boolean(s):"array"===i?.type?(console.log(`{'data': ${s}}`),e[t]=JSON5.parse(`{'data': ${s}}`)["data"]):e[t]=s)})),console.log({name:this.testingTool.name,arguments:e});const t=await this.mcpClient.callTool({name:this.testingTool.name,arguments:e});this.testResult=t,J.nk.success("工具执行成功")}catch(e){console.error("工具执行失败:",e),this.testResult={error:!0,message:e.message,stack:e.stack},J.nk.error(`工具执行失败: ${e.message}`)}finally{this.isTestingTool=!1}}else J.nk.error("MCP客户端未连接")},closeTestDialog(){this.showTestDialog=!1,this.testingTool=null,this.testParameters={},this.testResult=null}}},Z=s(71241);const ee=(0,Z.A)(Y,[["render",H],["__scopeId","data-v-00d6edb7"]]);var te=ee}}]);
//# sourceMappingURL=13.503b1e5b.js.map